<!DOCTYPE html>
<html>
<head>
    <title>Speech to Text</title>
</head>
<body>
    <h1>Speech to Text</h1>
    <button id="start-btn">Start Recording</button>
    <button id="stop-btn">Stop Recording</button>
    <p id="transcript"></p>

    <script>
        const startBtn = document.getElementById("start-btn");
        const stopBtn = document.getElementById("stop-btn");
        const transcript = document.getElementById("transcript");

        let mediaRecorder;
        let audioChunks = [];

        const socket = new WebSocket("ws://0.0.0.0:8000/ws/speech-to-text/");

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            transcript.textContent = data.message;
        };

        startBtn.addEventListener("click", async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = function(event) {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = function() {
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                const reader = new FileReader();
                reader.readAsDataURL(audioBlob);
                reader.onloadend = function() {
                    const base64String = reader.result.split(',')[1];
                    socket.send(JSON.stringify({ audio_data: base64String }));
                };
            };

            mediaRecorder.start();
        });

        stopBtn.addEventListener("click", () => {
            mediaRecorder.stop();
        });
    </script>
</body>
</html>
